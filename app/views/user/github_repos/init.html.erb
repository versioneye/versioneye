<% title "Github Repositories" %>

<div class="span3" >
  <%= render "/user/projects/helpers/navi" %>
</div>


<% if !current_user.github_account_connected? %>

  <div class="span8">
    <div class="row content_header_def" >
      Connect with GitHub to monitor your GitHub Repositories.
    </div>
    <div class="content " >
      <%= render 'shared/login_with_github', :btn => "signup" %>
    </div>
  </div>

<% else %>

  <div class="span8">
    <div class="row content_header_def" >
      <div id = "github-menu" ></div>
    </div>

    <% if !current_user.github_token.nil? && !current_user.github_scope.eql?("repo") %>
      <div class="content flash warning" >
        With the current scope we can fetch only your public repositories. If you want to monitor
        private repositories you have to grand us access to your private repositories:
        <a href='https://github.com/login/oauth/authorize?client_id=50fb47103b8a3f03b2cd&amp;scope=repo' style="margin-right: 5px;" >
          Grand access to private repositories
        </a><br/><br/>
      </div>
    <% end %>

    <div id = "github-repos" class="content" >
      <div >
        Please enable Javascript to see content of the page. Or just refresh page.
      </div>
    </div>
    <div id = "github-pagination"></div>
  </div>

<% end %>

<!-- templates for frontend app -->

<script id = "github-no-repo-template" type = "text/template">
  <div class = "notification">
    <strong>No repositories!</strong>
    <p>
      Both You and yours organizations dont have any Github repositories.
    </p>
  </div>
</script>

<script id = "github-pagination-template" type = "text/template">
  <div class = "pagination pagination-centered l_left_padding ">
    <button class = "btn btn-mini btn-warning btn-block btn-pagination-next"
      data-current-page = "{{= paging.currentPage}}"
      data-total-pages = "{{= paging.totalPages }}"
      data-per-page = "{{= paging.perPage }}"
      {{= (paging.currentPage  >= (paging.totalPages - 1)) ? " disabled " : ""}}>
      Show more ({{= (paging.currentPage + 1)}}/{{= paging.totalPages}})
    </button>
  </div>
</script>

<script id = "github-loading-template" type = "text/template">
  <div id = "github-loader">
    <div class="{{= classes }}">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      {{= message }}
    </div>
    <div>
      <img src = "/assets/loadingbar2.gif" style = "position: relative; left: 40%;">
    </div>
  </div>
</script>

<script id = "github-notification-template" type = "text/template">
  <div class="{{= classes }}">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    {{=  content }}
  </div>
</script>

<script id = "github-repo-info-template" type = "text/template">
  <div id = "github-repo-{{= repo.github_id}}" class = "repo-container">
    <div class = "repo-info row-fluid">
      <div class = "repo-logo span2">
        {{ var logo_path = "/assets/language/" }}
        {{ var logo_name = (repo.supported) ? repo.language : "ruby_bw" }}
        <img src   = {{= logo_path + logo_name + ".png"}}
             style = "position: relative; left: 25%; right: 25%; height: 72px; " />
      </div>
      <div class = "repo-info-content span10">
        <h5>{{= repo.fullname }}</h5>
        <div class ="repo-labels"></div>
        <div> {{= repo.description }} </div>
        <div class = "repo-controls row"></div>
        <div class = "repo-notification"></div>
      </div>
    </div>
  </div>
</script>

<script id = "github-repo-label-template" type = "text/template">
  <span class="{{= classes }}">
    {{= content }}
  </span>
</script>

<script id = "github-repo-urllabel-template" type = "text/template">
  <span class="">
    <a href= "{{= url }}">
      <span class = "{{= classes }}">{{= content }}</span>
    </a>
  </span>
</script>

<script id = "github-repo-control-template" type = "text/template">
  <span class="help-block">
    This project has {{= branches.length }} branches.
    {{= (imported_branches.length) ? " and you're tracking " + imported_branches.length + "of them." : ""}}
    {{=  (branches.length > 2) ? "Scroll down to see all of them" : "" }}
  </span>
</script>

<script id = "github-repo-control-item-template" type = "text/template">
  <div class = "row-fluid">
    <div class = "span3 item-switch"></div>
    <div class = "span8 item-title"> {{= branch }} </div>
  </div>
</script>

<script id = "github-repo-switch-template" type = "text/template">
  <div class = "github-switch switch">
    <input
      id = "{{= switch_id }}"
      type = "checkbox" class = "input"
      {{= !repo.supported ? ' disabled ' : '' }}
      {{= (_.has(repo.imported_branches, branch)) ? ' checked ': '' }}
      data-github-id = "{{= repo.github_id }}"
      data-github-project-id = "{{= (_.has(repo.imported_branches, branch)) ? repo.imported_branches[branch].project_id : null }}"
      data-github-fullname = "{{= repo.fullname }}"
      data-github-branch = "{{= branch }}" />
  </div>
</script>

<script id = "github-repo-select-template" type = "text/template">
  <select id = "{{= 'github-repo-select-' + repo.github_id}}" class = "span github-repo-select">
    {{= options}}
  </select>
</script>

<script id = "github-repo-select-option-template" type = "text/template">
  <option value = "{{= value }}" {{= selected}}>
    {{= content }}
  </option>
</script>

<script id = "github-menu-item-template" type = "text/template">
  <li class = "org-item">
      <a href="#org/{{= org.name}}">
        {{= org.name}} - {{= org.type}}
      </a>
  </li>
</script>

<script id = "github-menu-template" type = "text/template">
  <ul class="nav nav-pills">
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        Organizations
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu" id = "github-menu-orgs">Loading...</ul>
    </li>
   <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        Sort by
        <b class="caret"></b>
      </a>
      <ul id = "github-menu-sort" class="dropdown-menu">
        <li class="sort-item">
          <a href= "javascript:void(0)" data-field="language" data-order = "-1">Language</a>
        </li>
        <li class="sort-item">
          <a href= "javascript:void(0)" data-field="updated_at" data-order= "-1">Updated</a>
        </li>
        <li class="sort-item">
          <a href= "javascript:void(0)" data-field="private" data-order= "-1">Visibility</a>
        </li>
        <li class="sort-item">
          <a href= "javascript:void(0)" data-field="imported" data-order= "-1">Imported</a>
        </li>
        <li class="sort-item">
          <a href= "javascript:void(0)" data-field="name" data-order= "-1">Name</a>
        </li>
        <li class="sort-item">
          <a href= "javascript:void(0)" data-field="supported" data-order= "-1">Supported</a>
        </li>

      </ul>
    </li>
   <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        Filter by
        <b class="caret"></b>
      </a>
      <ul class="dropdown-menu">
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="coffeescript">
            <img src="/assets/language/javascript.png" style= "height: 20px; vertical-align: top;">
            CoffeeScript
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="clojure">
            <img src="/assets/language/clojure.png" style= "height: 20px; vertical-align: top;">
            Clojure
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="java">
             <img src="/assets/language/java.png" style= "height: 20px; vertical-align: top;">
             Java
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="javascript">
            <img src="/assets/language/javascript.png" style= "height: 20px; vertical-align: top;">
            Javascript
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="node.js">
            <img src="/assets/language/node.js.png" style= "height: 20px; vertical-align: top;">
            Node.js
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="php">
            <img src="/assets/language/php.png" style= "height: 20px; vertical-align: top;">
            PHP
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="python">
             <img src="/assets/language/python.png" style= "height: 20px; vertical-align: top;">
            Python
          </a>
        </li>
        <li class="filter-item">
          <a href= "javascript:void(0)" data-field="language" data-value="ruby">
            <img src="/assets/language/ruby.png" style= "height: 20px; vertical-align: top;">
            Ruby
          </a>
        </li>
    </ul>
    </li>
  </ul>
</script>
