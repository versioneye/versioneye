define(["underscore","backbone"],function(e,t){e.templateSettings={interpolate:/\{\{\=(.+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g};var n=t.View.extend({el:"#github-menu",template:e.template($("#github-menu-template").html()),item_template:e.template($("#github-menu-item-template").html()),initialize:function(e){this.collection.bind("change",this.render,this),this.collection.on("all",this.render,this),this.currentRepos=e.currentRepos,this.allRepos=e.allRepos,this.repoView=e.repoView},events:{"click li.org-item":"onOrgItem","click li.sort-item":"onSortItem","click li.filter-item":"onFilterItem","click #github-search-btn":"onSearchItem","submit #github-repo-search":"onSearchItem","keyup #github-repo-search":"onSearchItem","click #refresh-github-data":"onRefillCache"},render:function(){return console.log("Rendering menu..."),$(this.el).html(this.template({})),$(this.el).find("#github-menu-orgs").empty(),this.collection.each(function(e){$(this.el).find("#github-menu-orgs").append(this.item_template({org:e.toJSON()}))},this),this},onOrgItem:function(){console.debug("User clicked on org-item - cleaning filtering."),this.trackGA("ga_github_orgitem"),this.removePrevSelection()},onSortItem:function(e){console.debug("catched event on Sort button"),sort_params=$(e.target).data(),this.currentRepos.sortByField(sort_params.field,sort_params.order),sort_params.order=-1*parseInt(sort_params.order);var t="ga_github_sort_by_"+sort_params.field+"_"+sort_params.order;return this.trackGA(t),!1},removePrevSelection:function(){$(".filter-item").removeClass("active"),$(".filter-item").find(".checker").remove()},onFilterItem:function(t){var n=e.template('<i class="icon-ok checker" style="padding-left: 5px;"></i>'),i=$(t.target).parents(".filter-item"),r=$(t.target).data();if(this.currentRepos.currentPage=0,this.currentRepos.reset(),i.hasClass("active"))this.removePrevSelection(),this.allRepos.fetchAll(),this.currentRepos.appendNextPage(0);else{this.removePrevSelection(),i.addClass("active"),$(t.target).append(n({}));var a=this.currentRepos.filterByField(r.field,r.value);this.currentRepos.addNewItems(a)}var o="ga_github_filter_"+r.field+"_"+r.value;return this.trackGA(o),!0},onSearchItem:function(e){e.preventDefault();var t=$("#github-search-term").val();t.length<1&&(console.debug("Search term too short, going to reset view."),this.removePrevSelection(),this.currentRepos.reset());var n=this.allRepos.matchByName(t);return console.debug("user is searching: "+t),this.removePrevSelection(),this.currentRepos.reset(),this.currentRepos.addNewItems(n),this.trackGA("ga_github_search_filter"),!0},onRefillCache:function(e){var t=jQuery(e.currentTarget);if(t.hasClass("disabled"))return console.debug("Ignoring event on disabled button."),!1;t.addClass("disabled"),t.find("span.btn-title").text("Please wait..."),t.find(".btn-icon").addClass("icon-spin"),$("#github-loader-notification").html('<i class = "icon-spinner icon-spin"></i>Going to re-import all repositories');var n=this,i=function(){n.repoView.resetView(),t.find(".btn-icon").removeClass("icon-spin"),t.find("span.btn-title").text("Reimport all data"),t.removeClass("disabled")};return this.currentRepos.reset(),this.allRepos.clearAll(i),this.trackGA("ga_github_check_changes"),!0},trackGA:function(e){try{page_view(e)}catch(t){console.error("Cant track for google analytics")}}});return n});