define(["underscore","backbone","/assets/scm_app/views/repo_control_view","/assets/scm_app/views/label_view"],function(e,t,n,i){e.templateSettings={interpolate:/\{\{\=(.+?)\}\}/g,evaluate:/\{\{(.+?)\}\}/g};var a=t.View.extend({className:"spanX",template:e.template($("#github-repo-info-template").html()),info_template:e.template($("#github-repo-project-info-template").html()),events:{"click .controls > .toggle-next":"toggleBranchView","click .controls > .update-repo":"updateRepository"},render:function(){var t=new n({model:this.model}),a=new i({model:this.model}),r=this.template({repo:this.model.toJSON()});this.$el.html(r);var o=this.model.get("imported_files")||[],s=e.map(o,function(e){var t=e.branch+"/"+e.filename;return['<a href="',e.project_url,'" > ',t," </a>"].join("")}),l=this.info_template({branches:this.model.get("branches"),imported_urls:s});return this.$el.find(".repo-project-info").html(l),this.$el.find(".repo-controls").append(t.render().el),this.$el.find(".repo-labels").append(a.render().el),this},toggleBranchView:function(){var e=this.$el.find(".repo-slider"),t=this.$el.find(".repo-slider.current"),n="#"+t.data("next"),i=this.$el.find(n);return i.removeClass("hide"),e.toggleClass("current"),t.addClass("hide"),!1},updateRepository:function(){var e=this.$el.children(".repo-container").data(),t=this,n=this.$el.find(".controls .update-repo.btn");this.disableUpdateButton(n),this.showUpdateLoader(n),this.model.save({command:"update",command_data:e},{beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},success:function(e){t.onUpdateSuccess(e,n)},error:function(e,i){console.debug(i),t.onUpdateFailure(e,n,i)}})},onUpdateSuccess:function(e,t){console.debug("Update was successful."),this.removeUpdateLoader(t),this.enableUpdateButton(t),this.render()},onUpdateFailure:function(e,t){console.debug("Update failed;"),this.removeUpdateLoader(t),this.enableUpdateButton(t)},showUpdateLoader:function(e){e.find("i.icon-refresh").addClass("icon-spin"),e.find("span.btn-title").text("Reading the newest information")},removeUpdateLoader:function(e){e.find("i.icon-refresh").removeClass("icon-spin"),e.find("span.btn-title").text("Update the repository")},disableUpdateButton:function(e){e.addClass("disabled"),e.attr("disabled",!0)},enableUpdateButton:function(e){e.removeClass("disabled"),e.attr("disabled",!1)}});return a});