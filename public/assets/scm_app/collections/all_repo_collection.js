define(["underscore","backbone","/assets/libs/backbone.poller.min"],function(e,t,i){function n(t,i){var n=e.template($("#github-notification-template").html());$(".flash-container").html(n({classes:t,content:i})).fadeIn(400).delay(6e3).fadeOut(800)}var a=t.Model.extend({idAttribute:"_id"}),r=t.Collection.extend({model:a,url:"/missing/setting",initialize:function(e,t){console.debug("Scm options to collection"),console.debug(t.urls),this.urls=t.urls,this.url=t.urls.root,this.app=t.app,this.poller=i.get(this,{delay:1e3}),this.initViews=t.initViews},parse:function(t){return t.success?("done"===t.task_status&&(console.debug("Got all repos. Stopping poller;"),n("alert alert-success","Importing your SCM repositories is done."),this.poller.stop(),(e.isUndefined(t.repos)||e.isEmpty(t.repos)||e.isNull(t.repos))&&$("#github-repos").html("<strong>No Repositories</strong>")),e.isUndefined(t.repos)||e.isEmpty(t.repos)||e.isNull(t.repos)?(console.log("Got no repos;"),[]):(console.log("Got "+t.repos.length+" repos."),t.repos)):(this.poller.stop(),console.log("Backend issue while fetching repos."),console.log(t.message),$("#github-repos").html("<br/><strong>"+t.message+"</strong>"),[])},clearAll:function(e){console.debug("Going to clear cache: "+this.urls.clear);var t=$.get(this.urls.clear),i=this;t.success(function(){console.debug("Going to repoll content."),i.poller.start(),e()})},fetchAll:function(t){console.debug("#-- [deprecated] Going to re-fill repo cache"),this.fetch({cache:!1,reset:!0,success:function(i){if(0==i.length){var n=e.template($("#github-no-repo-template").html());return $("#github-repos").html(n({})),!1}e.isFunction(t)&&t(i)},error:function(){n("alert alert-error",'<div><i class="icon-info-sign"></i> Can not load your repositories due a connectivity issues.</div>'),$("#github-repos").html("Connection issues - can not read data from SCM.")}})},matchByName:function(e){var t=this.filter(function(t){return t.get("name").toLowerCase().indexOf(e)>=0},this);return t}});return r});