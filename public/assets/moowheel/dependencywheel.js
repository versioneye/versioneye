function show_info_box(e,t){box_name=t.infoBox,number_name=t.infoNumber,recursive_deps=e.length,t.data_length=e.length,info_box=document.getElementById(box_name),info_box&&(info_box.style.display="inline-block"),info_number=document.getElementById(number_name),info_number&&(info_number.innerHTML=recursive_deps),scope_name=document.getElementById("scope_name"),scope_name&&(scope_name.innerHTML="all"==t.scope?"":t.scope),"function"==typeof handle_path&&handle_path(t)}var DependencyWheel=new Class({options:{type:"default",center:{x:100,y:100},width:null,height:null,lines:{color:"random",lineWidth:2},imageSize:[24,24],radialMultiplier:3.47,hover:!0,hoverLines:{color:"rgba(255,255,255,255)",lineWidth:5},onItemClick:$empty,infoBox:"mooinfo",infoNumber:"moonumber",scope:"compile",data_border:70,canvas_id:"canvas",canvas_hover_id:"canvas_hover",product_key:"product_key",product_version:"product_version",product_name:"product_name",version:"version",show_label:!1,resize:!1,resize_ids:"container,section",resize_factor:11,container_id:"canvas-container",pinit:!0},initialize:function(e,t,n){if(this.data=e,data_length=e.length,this.radius=Math.round(this.options.radialMultiplier*data_length),this.setOptions(n),3>data_length&&(n.height="77",this.options.height="77",n.show_label=!1,this.options.show_label=!1),border=this.options.data_border,data_length>border&&0==this.options.resize)return show_info_box(e,n),!1;var i;if(!this.options.width||!this.options.height){for(var a=0,r=0;r<e.length;r++)e[r].text.length>a&&(a=e[r].text.length);i=2*(this.radius+8*a+this.options.imageSize[0])+12}t.empty(),t=$(t);var o=new Element("canvas",{width:(this.options.width?this.options.width:i)+"px",height:(this.options.height?this.options.height:i)+"px",id:this.options.canvas_id});t.adopt(o),"undefined"!=typeof G_vmlCanvasManager&&(o=$(G_vmlCanvasManager.initElement(o))),this.canvas=o,this.cx=o.getContext("2d"),this.maxCount=1;var s=this.canvas.getCoordinates();return this.options.center={x:s.width/2,y:s.height/2},CanvasTextFunctions.enable(this.cx),0==data_length?(this.cx.fillStyle="green",this.cx.font="42px Arial",this.cx.fillText("0",this.options.center.x-10,45),void show_info_box(this.data,this.options)):(this.options.hover&&(this.hoverCanvas=new Element("canvas",{styles:{position:"absolute",left:s.left+"px",top:s.top+"px",zIndex:9},id:this.options.canvas_hover_id,width:s.width+"px",height:s.height+"px"}),this.hoverCanvas.injectAfter(this.canvas),window.addEvent("resize",function(){var e=this.canvas.getCoordinates();this.hoverCanvas.setStyles({left:e.left+"px",top:e.top+"px"}),this.hoverCanvas.width=e.width,this.hoverCanvas.height=e.height}.bind(this)),"undefined"!=typeof G_vmlCanvasManager&&(this.hoverCanvas=$(G_vmlCanvasManager.initElement(this.hoverCanvas)))),this.data.each(function(e){e.connections.each(function(e){"array"==$type(e)&&e[1]>this.maxCount&&(this.maxCount=e[1])},this)},this),void this.draw())},setPoints:function(){this.points={},this.bboxes=[],this.numDegrees=360/this.data.length;for(var e=0,t=0;t<this.data.length;e+=this.numDegrees,t++)if(!this.data[t].colors){var n=(this.data[t],{});"random"==this.options.lines.color?(p1=100,p2=100,n.__default="rgba("+(Math.floor(Math.random()*p1)+p2)+","+(Math.floor(Math.random()*p1)+p2)+","+(Math.floor(Math.random()*p1)+p2)+", 1)"):n.__default=this.options.lines.color,this.data[t].colors=n}},pc:function(e){return 7*Math.round(e/7)},calcbbox:function(e,t,n,i){e=Number(e.toFixed(2)),t=Number(t.toFixed(2)),n=Number(n.toFixed(2));var a,r=this.options.center.x,o=this.options.center.y,s=(t-o)/(e-r),l={x:e-5*Math.cos((n+90)*(Math.PI/180)),y:t-5*Math.sin((n+90)*(Math.PI/180))},u=l.y-s*l.x;a=1/0==s||s==-1/0?function(e){return Math.abs(e-l.x)}:function(e,t){return Math.abs(s*e-t+u)/Math.sqrt(Math.pow(s,2)+1)};var c=this.cx.measureText("sans","10",this.data[i].text);c=Number(c.toFixed(2));var h,f={x:e+5*Math.cos((n+90)*(Math.PI/180)),y:t+5*Math.sin((n+90)*(Math.PI/180))},d=f.y-s*f.x;h=1/0==s||s==-1/0?function(e){return Math.abs(e-f.x)}:function(e,t){return Math.abs(s*e-t+d)/Math.sqrt(Math.pow(s,2)+1)},this.bboxes[i]=function(i,r){if(0==n&&0>i-e)return!1;if(n>0&&90>n&&0>i-e&&0>r-t)return!1;if(90==n&&0>r-t)return!1;if(n>90&&180>n&&i-e>0&&0>r-t)return!1;if(180==n&&i-e>0)return!1;if(n>180&&270>n&&i-e>0&&r-t>0)return!1;if(270==n&&r-t>0)return!1;if(n>270&&360>n&&0>i-e&&r-t>0)return!1;var o=Math.sqrt(Math.pow(i-e,2)+Math.pow(r-t,2)),s=a(i,r),l=h(i,r);return c+8>=o&&10>=s&&10>=l?!0:!1}},drawPoints:function(){for(var e=0,t=0;t<this.data.length;e+=this.numDegrees,t++){this.cx.beginPath(),this.cx.fillStyle=this.cx.strokeStyle=this.data[t].colors.__default;var n=this.options.center.x+Math.cos(e*(Math.PI/180))*this.radius,i=this.options.center.y+Math.sin(e*(Math.PI/180))*this.radius;this.cx.arc(n,i,4,0,2*Math.PI,0),this.cx.fill(),this.cx.closePath(),this.calcbbox(n,i,e,t),this.points[this.pc(n)]||(this.points[this.pc(n)]={}),this.points[this.pc(n)][this.pc(i)]=t,this.cx.save(),this.cx.translate(this.options.center.x,this.options.center.y),this.cx.rotate((e>90&&270>e?e-180:e)*(Math.PI/180));var a,r;e>90&&270>e?(a=-(this.radius+this.cx.measureText("sans","10",this.data[t].text+"")+8),r=a-30):(a=this.radius+8,r=a+6+this.cx.measureText("sans","10",this.data[t].text+"")),this.cx.drawText("sans","10",a,this.cx.fontAscent("sans","10")/2,this.data[t].text),this.data[t].image&&this.cx.drawImage($(this.data[t].image),r,-12,this.options.imageSize[0],this.options.imageSize[1]),this.cx.restore()}},getAngle:function(e){return e*(360/this.data.length)},getItemIdxById:function(e){"array"==$type(e)&&(e=e[0]);for(var t=0,n=this.data.length;n>t;t++)if(this.data[t].id==e)return t;return-1},drawConnection:function(e,t){t&&(document.getElementById(this.options.canvas_hover_id).style.top=document.getElementById(this.options.canvas_id).getCoordinates().top+"px");var n=t?this.hoverCanvas.getContext("2d"):this.cx,i=this.data[e],a=i.connections,r=this.getAngle(e),o=this.options.center.x+Math.cos(r*(Math.PI/180))*this.radius,s=this.options.center.y+Math.sin(r*(Math.PI/180))*this.radius;n.lineWidth=t?this.options.hoverLines.lineWidth:2;for(var l=0;l<a.length;l++){var u=this.getItemIdxById(a[l]),c=a[l],h=!(!i.dependencies||-1==i.dependencies.indexOf(c));n.beginPath(),n.moveTo(o,s),rpos=this.getAngle(u),x2=this.options.center.x+Math.cos(rpos*(Math.PI/180))*this.radius,y2=this.options.center.y+Math.sin(rpos*(Math.PI/180))*this.radius,cp1x=this.options.center.x+Math.cos(r*(Math.PI/180))*(this.radius/1.5),cp1y=this.options.center.y+Math.sin(r*(Math.PI/180))*(this.radius/1.5),cp2x=this.options.center.x+Math.cos(rpos*(Math.PI/180))*(this.radius/1.5),cp2y=this.options.center.y+Math.sin(rpos*(Math.PI/180))*(this.radius/1.5);var f=this.data[u];n.strokeStyle=t?this.getStrokeGradient(n,{x1:o,y1:s,c1:i.colors.__default,x2:x2,y2:y2,c2:f.colors.__default},h):i.colors[a[l][0]]?i.colors[a[l][0]]:i.colors.__default,n.beginPath(),n.moveTo(o,s),n.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x2,y2),n.stroke(),n.closePath()}if(!t)if(this.data[e+1]){var d=this;setTimeout(function(){d.drawConnection(e+1)},25)}else this.drawPoints(),this.options.show_label&&(n.fillStyle="lightgray",n.font="14px Arial",n.fillText("www.VersionEye.com",this.options.center.x-70,30)),show_info_box(this.data,this.options)},getStrokeGradient:function(e,t,n){var i=e.createLinearGradient(t.x1,t.y1,t.x2,t.y2);return n?(i.addColorStop(0,"rgba(0,0,127,0.5)"),i.addColorStop(1,"rgba(0,0,127,1)")):(i.addColorStop(0,"rgba(0,127,0,0.5)"),i.addColorStop(1,"rgba(0,127,0,1)")),i},draw:function(){this.data&&(this.setPoints(),this.drawConnection(0)),this.options.hover&&($(this.hoverCanvas).addEvent("mousemove",function(e){e=new Event(e);var t=$(this.hoverCanvas).getCoordinates(),n={x:e.page.x-t.left,y:e.page.y-t.top},i=function(e){var t={x:this.pc(e.x),y:this.pc(e.y)};if($defined(this.points[t.x])&&$defined(this.points[t.x][t.y]))return this.points[t.x][t.y];for(var n=0,i=this.bboxes.length;i>n;n++){var a=this.bboxes[n];if(a(e.x,e.y)===!0)return n}return!1}.bind(this),a=i(n);if(a!==!1){if(this.lastMouseOver==a)return;this.drawConnection(a,!0),this.lastMouseOver=a,this.canvas.setStyle("opacity","0.5"),this.hoverCanvas.setStyle("cursor","pointer")}else if($defined(this.lastMouseOver)){var r=this.hoverCanvas.getContext("2d");r.clearRect(0,0,t.width,t.height),r.save(),this.lastMouseOver=null,this.canvas.setStyle("opacity","1.0"),this.hoverCanvas.setStyle("cursor","default")}}.bind(this)),$(this.hoverCanvas).addEvent("click",function(e){this.options.onItemClick(this.data[this.lastMouseOver],e)}.bind(this)))},getTemperature:function(e,t){if("heat"==e){var n={r:t/.33,y:(t-.33)/.33,w:(t-.66)/.66},i=Math.round(255*n.r>255?255:255*n.r),a=Math.round(255*n.y>255?255:255*n.y),r=Math.round(255*n.w>255?255:255*n.w);return"rgba("+(0>i?0:i)+","+(0>a?0:a)+","+(0>r?0:r)+", "+(.8*t+.2)+")"}if("cold"==e){var i=Math.round(255*t),o=Math.round(130+125*t);return"rgba("+i+","+o+",255, "+(.8*t+.2)+")"}}});DependencyWheel.implement(new Options),DependencyWheel.Remote=new Class({Extends:DependencyWheel,initialize:function(e,t,n){var i=function(e){var i=[],a={};if(!e)return!1;if(border=n.data_border,e.length>border&&1==n.resize)for(n.width=e.length*n.resize_factor,n.height=e.length*n.resize_factor,element_ids=n.resize_ids.split(","),element_count=0;element_count<element_ids.length;element_count++)element=document.getElementById(element_ids[element_count]),new_width=n.width+20*element_count,element.offsetWidth<new_width&&(element.style.width=new_width+"px");for(var r=0,o=e.length;o>r;r++)e[r].imageUrl&&(i.push(e[r].imageUrl),a[r]=i.length-1);if(0==i.length)return!1;var s=new Asset.images(i,{onComplete:function(){for(var i in a)e[i].image=s[a[i]];arguments.callee._parent_=this.initialize._parent_,this.parent(e,t,n)}.bind(this)});return!0}.bind(this);n&&n.url?(json_url=n.url,new Request.JSON({url:json_url,onComplete:function(a){e=a,arguments.callee._parent_=this.initialize._parent_,i(e,t,n)||this.parent(e,t,n)}.bind(this)}).send()):i(e,t,n)||this.parent(e,t,n)}});