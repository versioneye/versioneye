define([require],function(t){function e(t){this.selector=t.selector||"#area4",this.margin=t.margin||{top:0,right:10,bottom:0,left:10},this.width=t.width||960,this.height=t.height||300,this.dataset=t.dataset||[];var e=this.height-(this.margin.top+this.margin.bottom);this.bar={width:10,maxHeight:e,padding:2},this.fontSize=t.fontSize||11,this.xScaler=d3.time.scale().rangeRound([0,this.width]),this.yScaler=d3.scale.linear().range([this.bar.maxHeight,0]),this.dateParser=d3.time.format("%Y-%m-%d").parse,this.bisectDate=d3.bisector(function(t){return t.date}).left}return e.prototype.loadAndRender=function(t){var e=this;d3.json(t,function(n,r){return n?(console.error("Can not load data for Timebar from url: "+t),1):(r.forEach(function(t){t.value=+t.value,t.date=e.dateParser(t.date)}),r.sort(function(t,e){return t.date-e.date}),void e.render(r))})},e.prototype.render=function(t){var e=this;e.dataset=t,e.xScaler.domain([new Date(t[0].date),d3.time.day.offset(new Date(t[t.length-1].date),1)]),e.yScaler.domain([0,d3.max(t,function(t){return t.value})]);var n=e.initCanvas(),r=n.select("g");e.bar.width=Math.round(e.width/(1*e.dataset.length))-e.bar.padding,r.selectAll(".bar").data(e.dataset).enter().append("rect").attr({"class":"bar",x:function(t){return e.xScaler(t.date)},width:e.bar.width,y:function(t){return e.yScaler(t.value)},height:function(t){return e.bar.maxHeight-e.yScaler(t.value)}}),r.selectAll(".barValues").data(e.dataset).enter().append("text").attr({x:function(t){return e.xScaler(t.date)+e.bar.width/2},y:function(t){return e.yScaler(t.value)+e.fontSize},fill:"white","text-anchor":"middle"}).text(function(t){return t.value}),e.addAxisX(n),e.addTooltip(n)},e.prototype.initCanvas=function(){var t=this,e=d3.select(t.selector).append("svg").attr({width:t.width,height:t.height});return e.append("g").attr("tranform","translate("+t.margin.left+","+t.margin.top+")"),e},e.prototype.addTooltip=function(t){var e=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),n=d3.time.format("%A, %e.%B");d3.selectAll(".bar").on("mouseover",function(t){e.transition().duration(200).style({opacity:.9,left:d3.event.pageX-10+"px",top:d3.event.pageY+"px"}).text(n(t.date))}).on("mouseout",function(t){e.transition().duration(500).style("opacity",0)})},e.prototype.addAxisX=function(t){var e=this,n=d3.svg.axis().scale(e.xScaler).ticks(d3.time.mondays,1).tickFormat(d3.time.format("%d-%m-%y")).orient("bottom");return t.append("g").attr({"class":"x axis",transform:"translate(0,"+(e.height-e.margin.bottom+5)+")",fill:"steelblue"}).call(n),t},e});