define([require],function(e){function t(e){this.selector=e.selector||"#area3",this.margin=e.margin||{top:20,right:10,bottom:30,left:10},this.padding=e.padding||{top:5,right:0,bottom:0,left:0},this.width=e.width||940,this.height=e.height||300,this.dataset=e.dataset||[],this.url=e.url||"/",this.xScaler=d3.time.scale().range([0,this.width-(this.margin.left+this.margin.right)]),this.yScaler=d3.scale.linear().range([this.height-(this.margin.top+this.margin.bottom),this.padding.top]),this.dateParser=d3.time.format("%Y-%m-%d").parse,this.bisectDate=d3.bisector(function(e){return e.date}).left,this.strokeScaler=d3.scale.category10()}return t.prototype.loadAndRender=function(e){var t=this;d3.json(e,function(n,r){return n?(console.error("Can not load for Timeline from url: "+e),1):(r.forEach(function(e){e.date=t.dateParser(e.date)}),r.sort(function(e,t){return e.date-t.date}),void t.render(r))})},t.prototype.initCanvas=function(){var e=this,t=d3.select(e.selector).append("svg").attr({width:e.width,height:e.height});return t.append("g").attr("tranform","translate("+e.margin.left+","+e.margin.top+")"),t},t.prototype.addAxisX=function(e){var t=this,n=d3.svg.axis().scale(t.xScaler).orient("bottom");return e.append("g").attr("class","x axis").attr("transform","translate(0,"+(t.height-t.margin.bottom)+")").call(n),e},t.prototype.addAxisY=function(e){var t=this;d3.svg.axis().scale(t.yScaler).orient("left");return e},t.prototype.addFocusator=function(e){function t(){var e=n.xScaler.invert(d3.mouse(this)[0]),t=n.dataset,i=n.bisectDate(t,e,1),o=t[i-1],a=i<t.length?t[i]:t[t.length-1],s=e-o.date>a.date-e?a:o;r.attr("transform","translate("+n.xScaler(s.date)+","+n.yScaler(s.value)+")"),r.select("text").text(s.value)}var n=this,r=e.append("g").attr("class","focus").style("display","none");r.append("circle").attr("r",4.5),r.append("text").attr({x:9,dy:".35em"}),e.append("rect").attr({"class":"overlay",width:n.width+"px",height:n.height+"px"}).on("mouseover",function(){r.style("display",null)}).on("mouseout",function(){r.style("display","none")}).on("mousemove",t)},t.prototype.registerEvents=function(){var e=this;d3.selectAll(".lang-timeline-btn").on("click",function(t){var n=d3.select(this).attr("data-lang"),r=e.url+"?lang="+n;d3.selectAll(".lang-timeline-btn").classed("active",!1),d3.select(this).classed("active",!0),d3.select(e.selector).select("svg").remove(),e.loadAndRender(r)})},t.prototype.render=function(e){var t=this;t.dataset=e,t.strokeScaler.domain(e.length),t.xScaler.domain(d3.extent(e,function(e){return e.date})),t.yScaler.domain(d3.extent(e,function(e){return e.value}));var n=t.initCanvas(),r=n.selectAll(".lang").data(t.dataset).enter().append("g").attr("class","lang1"),i=d3.svg.line().interpolate("linear").x(function(e,n){return t.xScaler(e.date)}).y(function(e,n){return t.yScaler(e.value)});r.append("path").style({stroke:"steelblue"}).attr({"class":"line",d:function(t){return i(e)}}),t.addAxisX(n),t.addFocusator(n),t.registerEvents()},t});