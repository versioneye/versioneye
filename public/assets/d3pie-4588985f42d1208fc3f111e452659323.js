/*!
 * d3pie
 * @author Ben Keen
 * @version 0.1.6
 * @date Feb 10 2014
 * @repo http://github.com/benkeen/d3pie
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e(require()):t.d3pie=e(t)}(this,function(){var t="d3pie",e="0.1.6",n=0,o={header:{title:{text:"",color:"#333333",fontSize:18,font:"arial"},subtitle:{text:"",color:"#666666",fontSize:14,font:"arial"},location:"top-center",titleSubtitlePadding:8},footer:{text:"",color:"#666666",fontSize:14,font:"arial",location:"left"},size:{canvasHeight:500,canvasWidth:500,pieInnerRadius:"0%",pieOuterRadius:null},data:{sortOrder:"none",ignoreSmallSegments:{enabled:!1,valueType:"percentage",value:null},smallSegmentGrouping:{enabled:!1,value:1,valueType:"percentage",label:"Other",color:"#cccccc"},content:[]},labels:{outer:{format:"label",hideWhenLessThanPercentage:null,pieDistance:30},inner:{format:"percentage",hideWhenLessThanPercentage:null},mainLabel:{color:"#333333",font:"arial",fontSize:10},percentage:{color:"#dddddd",font:"arial",fontSize:10,decimalPlaces:0},value:{color:"#cccc44",font:"arial",fontSize:10},lines:{enabled:!0,style:"curved",color:"segment"},truncation:{enabled:!1,length:30}},effects:{load:{effect:"default",speed:1e3},pullOutSegmentOnClick:{effect:"bounce",speed:300,size:10},highlightSegmentOnMouseover:!0,highlightLuminosity:-.2},tooltips:{enabled:!1,type:"placeholder",string:"",placeholderParser:null,styles:{fadeInSpeed:250,backgroundColor:"#000000",backgroundOpacity:.5,color:"#efefef",borderRadius:2,font:"arial",fontSize:10,padding:4}},misc:{colors:{background:null,segments:["#2484c1","#65a620","#7b6888","#a05d56","#961a1a","#d8d23a","#e98125","#d0743c","#635222","#6ada6a","#0c6197","#7d9058","#207f33","#44b9b0","#bca44a","#e4a14b","#a3acb2","#8cc3e9","#69a6f9","#5b388f","#546e91","#8bde95","#d2ab58","#273c71","#98bf6e","#4daa4b","#98abc5","#cc1010","#31383b","#006391","#c2643f","#b0a474","#a5a39c","#a9c2bc","#22af8c","#7fcecf","#987ac6","#3d3b87","#b77b1c","#c9c2b6","#807ece","#8db27c","#be66a2","#9ed3c6","#00644b","#005064","#77979f","#77e079","#9c73ab","#1f79a7"],segmentStroke:"#ffffff"},gradient:{enabled:!1,percentage:95,color:"#000000"},canvasPadding:{top:5,right:5,bottom:5,left:5},pieCenterOffset:{x:0,y:0},cssPrefix:null},callbacks:{onload:null,onMouseoverSegment:null,onMouseoutSegment:null,onClickSegment:null}},i={initialCheck:function(t){var e=t.cssPrefix,n=t.element,o=t.options;if(!window.d3||!window.d3.hasOwnProperty("version"))return console.error("d3pie error: d3 is not available"),!1;if(!(n instanceof HTMLElement||n instanceof SVGElement))return console.error("d3pie error: the first d3pie() param must be a valid DOM element (not jQuery) or a ID string."),!1;if(!/[a-zA-Z][a-zA-Z0-9_-]*$/.test(e))return console.error("d3pie error: invalid options.misc.cssPrefix"),!1;if(!s.isArray(o.data.content))return console.error("d3pie error: invalid config structure: missing data.content property."),!1;if(0===o.data.content.length)return console.error("d3pie error: no data supplied."),!1;for(var i=[],a=0;a<o.data.content.length;a++)"number"!=typeof o.data.content[a].value||isNaN(o.data.content[a].value)?console.log("not valid: ",o.data.content[a]):o.data.content[a].value<=0?console.log("not valid - should have positive value: ",o.data.content[a]):i.push(o.data.content[a]);return t.options.data.content=i,!0}},s={addSVGSpace:function(t){var e=t.element,n=t.options.size.canvasWidth,o=t.options.size.canvasHeight,i=t.options.misc.colors.background,s=d3.select(e).append("svg:svg").attr("width",n).attr("height",o);return"transparent"!==i&&s.style("background-color",function(){return i}),s},whenIdExists:function(t,e){var n=1,o=1e3,i=setInterval(function(){document.getElementById(t)&&(clearInterval(i),e()),n>o&&clearInterval(i),n++},1)},whenElementsExist:function(t,e){var n=1,o=1e3,i=setInterval(function(){for(var s=!0,a=0;a<t.length;a++)if(!document.getElementById(t[a])){s=!1;break}s&&(clearInterval(i),e()),n>o&&clearInterval(i),n++},1)},shuffleArray:function(t){for(var e,n,o=t.length;0!==o;)n=Math.floor(Math.random()*o),o-=1,e=t[o],t[o]=t[n],t[n]=e;return t},processObj:function(t,e,n){return"string"==typeof e?s.processObj(t,e.split("."),n):1===e.length&&void 0!==n?(t[e[0]]=n,t[e[0]]):0===e.length?t:s.processObj(t[e[0]],e.slice(1),n)},getDimensions:function(t){var e=document.getElementById(t),n=0,o=0;if(e){var i=e.getBBox();n=i.width,o=i.height}else console.log("error: getDimensions() "+t+" not found.");return{w:n,h:o}},rectIntersect:function(t,e){var n=e.x>t.x+t.w||e.x+e.w<t.x||e.y+e.h<t.y||e.y>t.y+t.h;return!n},getColorShade:function(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;for(var n="#",o=0;3>o;o++){var i=parseInt(t.substr(2*o,2),16);i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),n+=("00"+i).substr(i.length)}return n},initSegmentColors:function(t){for(var e=t.options.data.content,n=t.options.misc.colors.segments,o=[],i=0;i<e.length;i++)o.push(e[i].hasOwnProperty("color")?e[i].color:n[i]);return o},applySmallSegmentGrouping:function(t,e){var n;"percentage"===e.valueType&&(n=r.getTotalPieSize(t));for(var o=[],i=[],s=0,a=0;a<t.length;a++)if("percentage"===e.valueType){var l=t[a].value/n*100;if(l<=e.value){i.push(t[a]),s+=t[a].value;continue}t[a].isGrouped=!1,o.push(t[a])}else{if(t[a].value<=e.value){i.push(t[a]),s+=t[a].value;continue}t[a].isGrouped=!1,o.push(t[a])}return i.length&&o.push({color:e.color,label:e.label,value:s,isGrouped:!0,groupedData:i}),o},showPoint:function(t,e,n){t.append("circle").attr("cx",e).attr("cy",n).attr("r",2).style("fill","black")},isFunction:function(t){var e={};return t&&"[object Function]"===e.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},a=function(){var t,e,n,o,i,s,r=arguments[0]||{},l=1,c=arguments.length,u=!1,p=Object.prototype.toString,d=Object.prototype.hasOwnProperty,f={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},g={isFunction:function(t){return"function"===g.type(t)},isArray:Array.isArray||function(t){return"array"===g.type(t)},isWindow:function(t){return null!==t&&t===t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null===t?String(t):f[p.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==g.type(t)||t.nodeType)return!1;try{if(t.constructor&&!d.call(t,"constructor")&&!d.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var n;for(n in t);return void 0===n||d.call(t,n)}};for("boolean"==typeof r&&(u=r,r=arguments[1]||{},l=2),"object"==typeof r||g.isFunction(r)||(r={}),c===l&&(r=this,--l),l;c>l;l++)if(null!==(t=arguments[l]))for(e in t)n=r[e],o=t[e],r!==o&&(u&&o&&(g.isPlainObject(o)||(i=g.isArray(o)))?(i?(i=!1,s=n&&g.isArray(n)?n:[]):s=n&&g.isPlainObject(n)?n:{},r[e]=a(u,s,o)):void 0!==o&&(r[e]=o));return r},r={toRadians:function(t){return t*(Math.PI/180)},toDegrees:function(t){return t*(180/Math.PI)},computePieRadius:function(t){var e=t.options.size,n=t.options.misc.canvasPadding,o=e.canvasWidth-n.left-n.right,i=e.canvasHeight-n.top-n.bottom;"pie-center"!==t.options.header.location&&(i-=t.textComponents.headerHeight),t.textComponents.footer.exists&&(i-=t.textComponents.footer.h),i=0>i?0:i;var s,a,r=(i>o?o:i)/3;if(null!==e.pieOuterRadius)if(/%/.test(e.pieOuterRadius)){a=parseInt(e.pieOuterRadius.replace(/[\D]/,""),10),a=a>99?99:a,a=0>a?0:a;var l=i>o?o:i;if("none"!==t.options.labels.outer.format){var c=2*parseInt(t.options.labels.outer.pieDistance,10);l-c>0&&(l-=c)}r=Math.floor(l/100*a)/2}else r=parseInt(e.pieOuterRadius,10);/%/.test(e.pieInnerRadius)?(a=parseInt(e.pieInnerRadius.replace(/[\D]/,""),10),a=a>99?99:a,a=0>a?0:a,s=Math.floor(r/100*a)):s=parseInt(e.pieInnerRadius,10),t.innerRadius=s,t.outerRadius=r},getTotalPieSize:function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n].value;return e},sortPieData:function(t){var e=t.options.data.content,n=t.options.data.sortOrder;switch(n){case"none":break;case"random":e=s.shuffleArray(e);break;case"value-asc":e.sort(function(t,e){return t.value<e.value?-1:1});break;case"value-desc":e.sort(function(t,e){return t.value<e.value?1:-1});break;case"label-asc":e.sort(function(t,e){return t.label.toLowerCase()>e.label.toLowerCase()?1:-1});break;case"label-desc":e.sort(function(t,e){return t.label.toLowerCase()<e.label.toLowerCase()?1:-1})}return e},getPieTranslateCenter:function(t){return"translate("+t.x+","+t.y+")"},calculatePieCenter:function(t){var e=t.options.misc.pieCenterOffset,n=t.textComponents.title.exists&&"pie-center"!==t.options.header.location,o=t.textComponents.subtitle.exists&&"pie-center"!==t.options.header.location,i=t.options.misc.canvasPadding.top;n&&o?i+=t.textComponents.title.h+t.options.header.titleSubtitlePadding+t.textComponents.subtitle.h:n?i+=t.textComponents.title.h:o&&(i+=t.textComponents.subtitle.h);var s=0;t.textComponents.footer.exists&&(s=t.textComponents.footer.h+t.options.misc.canvasPadding.bottom);var a=(t.options.size.canvasWidth-t.options.misc.canvasPadding.left-t.options.misc.canvasPadding.right)/2+t.options.misc.canvasPadding.left,r=(t.options.size.canvasHeight-s-i)/2+i;a+=e.x,r+=e.y,t.pieCenter={x:a,y:r}},rotate:function(t,e,n,o,i){i=i*Math.PI/180;var s=Math.cos,a=Math.sin,r=(t-n)*s(i)-(e-o)*a(i)+n,l=(t-n)*a(i)+(e-o)*s(i)+o;return{x:r,y:l}},translate:function(t,e,n,o){var i=r.toRadians(o);return{x:t+n*Math.sin(i),y:e-n*Math.cos(i)}},pointIsInArc:function(t,e,n){var o=n.innerRadius()(e),i=n.outerRadius()(e),s=n.startAngle()(e),a=n.endAngle()(e),r=t.x*t.x+t.y*t.y,l=Math.atan2(t.x,-t.y);return l=0>l?l+2*Math.PI:l,r>=o*o&&i*i>=r&&l>=s&&a>=l}},l={add:function(t,e,n){var o=l.getIncludes(n),i=t.options.labels,s=t.svg.insert("g","."+t.cssPrefix+"labels-"+e).attr("class",t.cssPrefix+"labels-"+e),a=s.selectAll("."+t.cssPrefix+"labelGroup-"+e).data(t.options.data.content).enter().append("g").attr("id",function(n,o){return t.cssPrefix+"labelGroup"+o+"-"+e}).attr("data-index",function(t,e){return e}).attr("class",t.cssPrefix+"labelGroup-"+e).style("opacity",0);o.mainLabel&&a.append("text").attr("id",function(n,o){return t.cssPrefix+"segmentMainLabel"+o+"-"+e}).attr("class",t.cssPrefix+"segmentMainLabel-"+e).text(function(t){var e=t.label;return i.truncation.enabled&&t.label.length>i.truncation.length&&(e=t.label.substring(0,i.truncation.length)+"..."),e}).style("font-size",i.mainLabel.fontSize+"px").style("font-family",i.mainLabel.font).style("fill",i.mainLabel.color),o.percentage&&a.append("text").attr("id",function(n,o){return t.cssPrefix+"segmentPercentage"+o+"-"+e}).attr("class",t.cssPrefix+"segmentPercentage-"+e).text(function(e,n){return c.getPercentage(t,n,t.options.labels.percentage.decimalPlaces)+"%"}).style("font-size",i.percentage.fontSize+"px").style("font-family",i.percentage.font).style("fill",i.percentage.color),o.value&&a.append("text").attr("id",function(n,o){return t.cssPrefix+"segmentValue"+o+"-"+e}).attr("class",t.cssPrefix+"segmentValue-"+e).text(function(t){return t.value}).style("font-size",i.value.fontSize+"px").style("font-family",i.value.font).style("fill",i.value.color)},positionLabelElements:function(t,e,n){l["dimensions-"+e]=[];var o=d3.selectAll("."+t.cssPrefix+"labelGroup-"+e);o.each(function(){var n=d3.select(this).selectAll("."+t.cssPrefix+"segmentMainLabel-"+e),o=d3.select(this).selectAll("."+t.cssPrefix+"segmentPercentage-"+e),i=d3.select(this).selectAll("."+t.cssPrefix+"segmentValue-"+e);l["dimensions-"+e].push({mainLabel:null!==n.node()?n.node().getBBox():null,percentage:null!==o.node()?o.node().getBBox():null,value:null!==i.node()?i.node().getBBox():null})});var i=5,s=l["dimensions-"+e];switch(n){case"label-value1":d3.selectAll("."+t.cssPrefix+"segmentValue-"+e).attr("dx",function(t,e){return s[e].mainLabel.width+i});break;case"label-value2":d3.selectAll("."+t.cssPrefix+"segmentValue-"+e).attr("dy",function(t,e){return s[e].mainLabel.height});break;case"label-percentage1":d3.selectAll("."+t.cssPrefix+"segmentPercentage-"+e).attr("dx",function(t,e){return s[e].mainLabel.width+i});break;case"label-percentage2":d3.selectAll("."+t.cssPrefix+"segmentPercentage-"+e).attr("dx",function(t,e){return s[e].mainLabel.width/2-s[e].percentage.width/2}).attr("dy",function(t,e){return s[e].mainLabel.height})}},computeLabelLinePositions:function(t){t.lineCoordGroups=[],d3.selectAll("."+t.cssPrefix+"labelGroup-outer").each(function(e,n){return l.computeLinePosition(t,n)})},computeLinePosition:function(t,e){var n,o,i,s,a=c.getSegmentAngle(e,t.options.data.content,t.totalSize,{midpoint:!0}),l=r.rotate(t.pieCenter.x,t.pieCenter.y-t.outerRadius,t.pieCenter.x,t.pieCenter.y,a),u=t.outerLabelGroupData[e].h/5,p=6,d=Math.floor(a/90),f=4;switch(2===d&&180===a&&(d=1),d){case 0:n=t.outerLabelGroupData[e].x-p-(t.outerLabelGroupData[e].x-p-l.x)/2,o=t.outerLabelGroupData[e].y+(l.y-t.outerLabelGroupData[e].y)/f,i=t.outerLabelGroupData[e].x-p,s=t.outerLabelGroupData[e].y-u;break;case 1:n=l.x+(t.outerLabelGroupData[e].x-l.x)/f,o=l.y+(t.outerLabelGroupData[e].y-l.y)/f,i=t.outerLabelGroupData[e].x-p,s=t.outerLabelGroupData[e].y-u;break;case 2:var g=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+p;n=l.x-(l.x-g)/f,o=l.y+(t.outerLabelGroupData[e].y-l.y)/f,i=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+p,s=t.outerLabelGroupData[e].y-u;break;case 3:var h=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+p;n=h+(l.x-h)/f,o=t.outerLabelGroupData[e].y+(l.y-t.outerLabelGroupData[e].y)/f,i=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+p,s=t.outerLabelGroupData[e].y-u}t.lineCoordGroups[e]="straight"===t.options.labels.lines.style?[{x:l.x,y:l.y},{x:i,y:s}]:[{x:l.x,y:l.y},{x:n,y:o},{x:i,y:s}]},addLabelLines:function(t){var e=t.svg.insert("g","."+t.cssPrefix+"pieChart").attr("class",t.cssPrefix+"lineGroups").style("opacity",0),n=e.selectAll("."+t.cssPrefix+"lineGroup").data(t.lineCoordGroups).enter().append("g").attr("class",t.cssPrefix+"lineGroup"),o=d3.svg.line().interpolate("basis").x(function(t){return t.x}).y(function(t){return t.y});n.append("path").attr("d",o).attr("stroke",function(e,n){return"segment"===t.options.labels.lines.color?t.options.colors[n]:t.options.labels.lines.color}).attr("stroke-width",1).attr("fill","none").style("opacity",function(e,n){var o=t.options.labels.outer.hideWhenLessThanPercentage,i=c.getPercentage(t,n,t.options.labels.percentage.decimalPlaces),s=null!==o&&o>i||""===t.options.data.content[n].label;return s?0:1})},positionLabelGroups:function(t,e){d3.selectAll("."+t.cssPrefix+"labelGroup-"+e).style("opacity",0).attr("transform",function(n,o){var i,l;if("outer"===e)i=t.outerLabelGroupData[o].x,l=t.outerLabelGroupData[o].y;else{var u=a(!0,{},t.pieCenter);if(t.innerRadius>0){var p=c.getSegmentAngle(o,t.options.data.content,t.totalSize,{midpoint:!0}),d=r.translate(t.pieCenter.x,t.pieCenter.y,t.innerRadius,p);u.x=d.x,u.y=d.y}var f=s.getDimensions(t.cssPrefix+"labelGroup"+o+"-inner"),g=f.w/2,h=f.h/4;i=u.x+(t.lineCoordGroups[o][0].x-u.x)/1.8,l=u.y+(t.lineCoordGroups[o][0].y-u.y)/1.8,i-=g,l+=h}return"translate("+i+","+l+")"})},fadeInLabelsAndLines:function(t){var e="default"===t.options.effects.load.effect?t.options.effects.load.speed:1;setTimeout(function(){var e="default"===t.options.effects.load.effect?400:1;d3.selectAll("."+t.cssPrefix+"labelGroup-outer").transition().duration(e).style("opacity",function(e,n){var o=t.options.labels.outer.hideWhenLessThanPercentage,i=c.getPercentage(t,n,t.options.labels.percentage.decimalPlaces);return null!==o&&o>i?0:1}),d3.selectAll("."+t.cssPrefix+"labelGroup-inner").transition().duration(e).style("opacity",function(e,n){var o=t.options.labels.inner.hideWhenLessThanPercentage,i=c.getPercentage(t,n,t.options.labels.percentage.decimalPlaces);return null!==o&&o>i?0:1}),d3.selectAll("g."+t.cssPrefix+"lineGroups").transition().duration(e).style("opacity",1),s.isFunction(t.options.callbacks.onload)&&setTimeout(function(){try{t.options.callbacks.onload()}catch(e){}},e)},e)},getIncludes:function(t){var e=!1,n=!1,o=!1;switch(t){case"label":e=!0;break;case"value":n=!0;break;case"percentage":o=!0;break;case"label-value1":case"label-value2":e=!0,n=!0;break;case"label-percentage1":case"label-percentage2":e=!0,o=!0}return{mainLabel:e,value:n,percentage:o}},computeOuterLabelCoords:function(t){t.svg.selectAll("."+t.cssPrefix+"labelGroup-outer").each(function(e,n){return l.getIdealOuterLabelPositions(t,n)}),l.resolveOuterLabelCollisions(t)},resolveOuterLabelCollisions:function(t){var e=t.options.data.content.length;l.checkConflict(t,0,"clockwise",e),l.checkConflict(t,e-1,"anticlockwise",e)},checkConflict:function(t,e,n,o){var i,a;if(!(1>=o)){var r=t.outerLabelGroupData[e].hs;if(!("clockwise"===n&&"right"!==r||"anticlockwise"===n&&"left"!==r)){var c="clockwise"===n?e+1:e-1,u=t.outerLabelGroupData[e],p=t.outerLabelGroupData[c],d={labelHeights:t.outerLabelGroupData[0].h,center:t.pieCenter,lineLength:t.outerRadius+t.options.labels.outer.pieDistance,heightChange:t.outerLabelGroupData[0].h+1};if("clockwise"===n){for(i=0;e>=i;i++)if(a=t.outerLabelGroupData[i],s.rectIntersect(a,p)){l.adjustLabelPos(t,c,u,d);break}}else for(i=o-1;i>=e;i--)if(a=t.outerLabelGroupData[i],s.rectIntersect(a,p)){l.adjustLabelPos(t,c,u,d);break}l.checkConflict(t,c,n,o)}}},adjustLabelPos:function(t,e,n,o){var i,s,a,r;r=n.y+o.heightChange,s=o.center.y-r,i=Math.sqrt(Math.abs(o.lineLength)>Math.abs(s)?o.lineLength*o.lineLength-s*s:s*s-o.lineLength*o.lineLength),a="right"===n.hs?o.center.x+i:o.center.x-i-t.outerLabelGroupData[e].w,t.outerLabelGroupData[e].x=a,t.outerLabelGroupData[e].y=r},getIdealOuterLabelPositions:function(t,e){var n=d3.select("#"+t.cssPrefix+"labelGroup"+e+"-outer").node().getBBox(),o=c.getSegmentAngle(e,t.options.data.content,t.totalSize,{midpoint:!0}),i=t.pieCenter.x,s=t.pieCenter.y-(t.outerRadius+t.options.labels.outer.pieDistance),a=r.rotate(i,s,t.pieCenter.x,t.pieCenter.y,o),l="right";o>180?(a.x-=n.width+8,l="left"):a.x+=8,t.outerLabelGroupData[e]={x:a.x,y:a.y,w:n.width,h:n.height,hs:l}}},c={create:function(t){var e=t.pieCenter,n=t.options.colors,o=t.options.effects.load,i=t.options.misc.colors.segmentStroke,s=t.svg.insert("g","#"+t.cssPrefix+"title").attr("transform",function(){return r.getPieTranslateCenter(e)}).attr("class",t.cssPrefix+"pieChart"),a=d3.svg.arc().innerRadius(t.innerRadius).outerRadius(t.outerRadius).startAngle(0).endAngle(function(e){return e.value/t.totalSize*2*Math.PI}),l=s.selectAll("."+t.cssPrefix+"arc").data(t.options.data.content).enter().append("g").attr("class",t.cssPrefix+"arc"),u=o.speed;"none"===o.effect&&(u=0),l.append("path").attr("id",function(e,n){return t.cssPrefix+"segment"+n}).attr("fill",function(e,o){var i=n[o];return t.options.misc.gradient.enabled&&(i="url(#"+t.cssPrefix+"grad"+o+")"),i}).style("stroke",i).style("stroke-width",1).transition().ease("cubic-in-out").duration(u).attr("data-index",function(t,e){return e}).attrTween("d",function(e){var n=d3.interpolate({value:0},e);return function(e){return t.arc(n(e))}}),t.svg.selectAll("g."+t.cssPrefix+"arc").attr("transform",function(e,n){var o=0;return n>0&&(o=c.getSegmentAngle(n-1,t.options.data.content,t.totalSize)),"rotate("+o+")"}),t.arc=a},addGradients:function(t){var e=t.svg.append("defs").selectAll("radialGradient").data(t.options.data.content).enter().append("radialGradient").attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r","120%").attr("id",function(e,n){return t.cssPrefix+"grad"+n});e.append("stop").attr("offset","0%").style("stop-color",function(e,n){return t.options.colors[n]}),e.append("stop").attr("offset",t.options.misc.gradient.percentage+"%").style("stop-color",t.options.misc.gradient.color)},addSegmentEventHandlers:function(t){var e=d3.selectAll("."+t.cssPrefix+"arc,."+t.cssPrefix+"labelGroup-inner,."+t.cssPrefix+"labelGroup-outer");e.on("click",function(){var e,n=d3.select(this);if(n.attr("class")===t.cssPrefix+"arc")e=n.select("path");else{var o=n.attr("data-index");e=d3.select("#"+t.cssPrefix+"segment"+o)}var i=e.attr("class")===t.cssPrefix+"expanded";c.onSegmentEvent(t,t.options.callbacks.onClickSegment,e,i),"none"!==t.options.effects.pullOutSegmentOnClick.effect&&(i?c.closeSegment(t,e.node()):c.openSegment(t,e.node()))}),e.on("mouseover",function(){var e,n,o=d3.select(this);if(o.attr("class")===t.cssPrefix+"arc"?e=o.select("path"):(n=o.attr("data-index"),e=d3.select("#"+t.cssPrefix+"segment"+n)),t.options.effects.highlightSegmentOnMouseover){n=e.attr("data-index");var i=t.options.colors[n];e.style("fill",s.getColorShade(i,t.options.effects.highlightLuminosity))}t.options.tooltips.enabled&&(n=e.attr("data-index"),p.showTooltip(t,n));var a=e.attr("class")===t.cssPrefix+"expanded";c.onSegmentEvent(t,t.options.callbacks.onMouseoverSegment,e,a)}),e.on("mousemove",function(){p.moveTooltip(t)}),e.on("mouseout",function(){var e,n,o=d3.select(this);if(o.attr("class")===t.cssPrefix+"arc"?e=o.select("path"):(n=o.attr("data-index"),e=d3.select("#"+t.cssPrefix+"segment"+n)),t.options.effects.highlightSegmentOnMouseover){n=e.attr("data-index");var i=t.options.colors[n];t.options.misc.gradient.enabled&&(i="url(#"+t.cssPrefix+"grad"+n+")"),e.style("fill",i)}t.options.tooltips.enabled&&(n=e.attr("data-index"),p.hideTooltip(t,n));var s=e.attr("class")===t.cssPrefix+"expanded";c.onSegmentEvent(t,t.options.callbacks.onMouseoutSegment,e,s)})},onSegmentEvent:function(t,e,n,o){if(s.isFunction(e)){var i=parseInt(n.attr("data-index"),10);e({segment:n.node(),index:i,expanded:o,data:t.options.data.content[i]})}},openSegment:function(t,e){t.isOpeningSegment||(t.isOpeningSegment=!0,d3.selectAll("."+t.cssPrefix+"expanded").length>0&&c.closeSegment(t,d3.select("."+t.cssPrefix+"expanded").node()),d3.select(e).transition().ease(t.options.effects.pullOutSegmentOnClick.effect).duration(t.options.effects.pullOutSegmentOnClick.speed).attr("transform",function(e){var n=t.arc.centroid(e),o=n[0],i=n[1],s=Math.sqrt(o*o+i*i),a=parseInt(t.options.effects.pullOutSegmentOnClick.size,10);return"translate("+o/s*a+","+i/s*a+")"}).each("end",function(){t.currentlyOpenSegment=e,t.isOpeningSegment=!1,d3.select(this).attr("class",t.cssPrefix+"expanded")}))},closeSegment:function(t,e){d3.select(e).transition().duration(400).attr("transform","translate(0,0)").each("end",function(){d3.select(this).attr("class",""),t.currentlyOpenSegment=null})},getCentroid:function(t){var e=t.getBBox();return{x:e.x+e.width/2,y:e.y+e.height/2}},getSegmentAngle:function(t,e,n,o){var i,s=a({compounded:!0,midpoint:!1},o),r=e[t].value;if(s.compounded){i=0;for(var l=0;t>=l;l++)i+=e[l].value}"undefined"==typeof i&&(i=r);var c=i/n*360;if(s.midpoint){var u=r/n*360;c-=u/2}return c},getPercentage:function(t,e,n){var o=t.options.data.content[e].value/t.totalSize;return 0>=n?Math.round(100*o):(100*o).toFixed(n)}},u={offscreenCoord:-1e4,addTitle:function(t){t.svg.selectAll("."+t.cssPrefix+"title").data([t.options.header.title]).enter().append("text").text(function(t){return t.text}).attr({id:t.cssPrefix+"title","class":t.cssPrefix+"title",x:u.offscreenCoord,y:u.offscreenCoord}).attr("text-anchor",function(){var e;return e="top-center"===t.options.header.location||"pie-center"===t.options.header.location?"middle":"left"}).attr("fill",function(t){return t.color}).style("font-size",function(t){return t.fontSize+"px"}).style("font-family",function(t){return t.font})},positionTitle:function(t){var e,n=t.textComponents,o=t.options.header.location,i=t.options.misc.canvasPadding,s=t.options.size.canvasWidth,a=t.options.header.titleSubtitlePadding;e="top-left"===o?i.left:(s-i.right)/2+i.left,e+=t.options.misc.pieCenterOffset.x;var r=i.top+n.title.h;if("pie-center"===o)if(r=t.pieCenter.y,n.subtitle.exists){var l=n.title.h+a+n.subtitle.h;r=r-l/2+n.title.h}else r+=n.title.h/4;t.svg.select("#"+t.cssPrefix+"title").attr("x",e).attr("y",r)},addSubtitle:function(t){var e=t.options.header.location;t.svg.selectAll("."+t.cssPrefix+"subtitle").data([t.options.header.subtitle]).enter().append("text").text(function(t){return t.text}).attr("x",u.offscreenCoord).attr("y",u.offscreenCoord).attr("id",t.cssPrefix+"subtitle").attr("class",t.cssPrefix+"subtitle").attr("text-anchor",function(){var t;return t="top-center"===e||"pie-center"===e?"middle":"left"}).attr("fill",function(t){return t.color}).style("font-size",function(t){return t.fontSize+"px"}).style("font-family",function(t){return t.font})},positionSubtitle:function(t){var e,n=t.options.misc.canvasPadding,o=t.options.size.canvasWidth;e="top-left"===t.options.header.location?n.left:(o-n.right)/2+n.left,e+=t.options.misc.pieCenterOffset.x;var i=u.getHeaderHeight(t);t.svg.select("#"+t.cssPrefix+"subtitle").attr("x",e).attr("y",i)},addFooter:function(t){t.svg.selectAll("."+t.cssPrefix+"footer").data([t.options.footer]).enter().append("text").text(function(t){return t.text}).attr("x",u.offscreenCoord).attr("y",u.offscreenCoord).attr("id",t.cssPrefix+"footer").attr("class",t.cssPrefix+"footer").attr("text-anchor",function(){var e="left";return"bottom-center"===t.options.footer.location?e="middle":"bottom-right"===t.options.footer.location&&(e="left"),e}).attr("fill",function(t){return t.color}).style("font-size",function(t){return t.fontSize+"px"}).style("font-family",function(t){return t.font})},positionFooter:function(t){var e,n=t.options.footer.location,o=t.textComponents.footer.w,i=t.options.size.canvasWidth,s=t.options.size.canvasHeight,a=t.options.misc.canvasPadding;e="bottom-left"===n?a.left:"bottom-right"===n?i-o-a.right:i/2,t.svg.select("#"+t.cssPrefix+"footer").attr("x",e).attr("y",s-a.bottom)},getHeaderHeight:function(t){var e;if(t.textComponents.title.exists){var n=t.textComponents.title.h+t.options.header.titleSubtitlePadding+t.textComponents.subtitle.h;e="pie-center"===t.options.header.location?t.pieCenter.y-n/2+n:n+t.options.misc.canvasPadding.top}else if("pie-center"===t.options.header.location){var o=t.options.misc.canvasPadding.bottom+t.textComponents.footer.h;e=(t.options.size.canvasHeight-o)/2+t.options.misc.canvasPadding.top+t.textComponents.subtitle.h/2}else e=t.options.misc.canvasPadding.top+t.textComponents.subtitle.h;return e}},p={addTooltips:function(t){var e=t.svg.insert("g").attr("class",t.cssPrefix+"tooltips");e.selectAll("."+t.cssPrefix+"tooltip").data(t.options.data.content).enter().append("g").attr("class",t.cssPrefix+"tooltip").attr("id",function(e,n){return t.cssPrefix+"tooltip"+n}).style("opacity",0).append("rect").attr({rx:t.options.tooltips.styles.borderRadius,ry:t.options.tooltips.styles.borderRadius,x:-t.options.tooltips.styles.padding,opacity:t.options.tooltips.styles.backgroundOpacity}).style("fill",t.options.tooltips.styles.backgroundColor),e.selectAll("."+t.cssPrefix+"tooltip").data(t.options.data.content).append("text").attr("fill",function(){return t.options.tooltips.styles.color}).style("font-size",function(){return t.options.tooltips.styles.fontSize}).style("font-family",function(){return t.options.tooltips.styles.font}).text(function(e,n){var o=t.options.tooltips.string;return"caption"===t.options.tooltips.type&&(o=e.caption),p.replacePlaceholders(t,o,n,{label:e.label,value:e.value,percentage:c.getPercentage(t,n,t.options.labels.percentage.decimalPlaces)})}),e.selectAll("."+t.cssPrefix+"tooltip rect").attr({width:function(e,n){var o=s.getDimensions(t.cssPrefix+"tooltip"+n);return o.w+2*t.options.tooltips.styles.padding},height:function(e,n){var o=s.getDimensions(t.cssPrefix+"tooltip"+n);return o.h+2*t.options.tooltips.styles.padding},y:function(e,n){var o=s.getDimensions(t.cssPrefix+"tooltip"+n);return-(o.h/2)+1}})},showTooltip:function(t,e){var n=t.options.tooltips.styles.fadeInSpeed;p.currentTooltip===e&&(n=1),p.currentTooltip=e,d3.select("#"+t.cssPrefix+"tooltip"+e).transition().duration(n).style("opacity",function(){return 1}),p.moveTooltip(t)},moveTooltip:function(t){d3.selectAll("#"+t.cssPrefix+"tooltip"+p.currentTooltip).attr("transform",function(){var e=d3.mouse(this.parentNode),n=e[0]+t.options.tooltips.styles.padding+2,o=e[1]-2*t.options.tooltips.styles.padding-2;return"translate("+n+","+o+")"})},hideTooltip:function(t,e){d3.select("#"+t.cssPrefix+"tooltip"+e).style("opacity",function(){return 0}),d3.select("#"+t.cssPrefix+"tooltip"+p.currentTooltip).attr("transform",function(){var e=t.options.size.canvasWidth+1e3,n=t.options.size.canvasHeight+1e3;return"translate("+e+","+n+")"})},replacePlaceholders:function(t,e,n,o){s.isFunction(t.options.tooltips.placeholderParser)&&t.options.tooltips.placeholderParser(n,o);var i=function(){return function(){var t=arguments[1];return o.hasOwnProperty(t)?o[arguments[1]]:arguments[0]}};return e.replace(/\{(\w+)\}/g,i(o))}},d=function(l,c){if(this.element=l,"string"==typeof l){var u=l.replace(/^#/,"");this.element=document.getElementById(u)}var p={};a(!0,p,o,c),this.options=p,null!==this.options.misc.cssPrefix?this.cssPrefix=this.options.misc.cssPrefix:(this.cssPrefix="p"+n+"_",n++),i.initialCheck(this)&&(d3.select(this.element).attr(t,e),this.options.data.content=r.sortPieData(this),this.options.data.smallSegmentGrouping.enabled&&(this.options.data.content=s.applySmallSegmentGrouping(this.options.data.content,this.options.data.smallSegmentGrouping)),this.options.colors=s.initSegmentColors(this),this.totalSize=r.getTotalPieSize(this.options.data.content),f.call(this))};d.prototype.recreate=function(){this.options.data.content=r.sortPieData(this),this.options.data.smallSegmentGrouping.enabled&&(this.options.data.content=s.applySmallSegmentGrouping(this.options.data.content,this.options.data.smallSegmentGrouping)),this.options.colors=s.initSegmentColors(this),this.totalSize=r.getTotalPieSize(this.options.data.content),f.call(this)},d.prototype.redraw=function(){this.element.innerHTML="",f.call(this)},d.prototype.destroy=function(){this.element.innerHTML="",d3.select(this.element).attr(t,null)},d.prototype.getOpenSegment=function(){var t=this.currentlyOpenSegment;if(null!==t&&"undefined"!=typeof t){var e=parseInt(d3.select(t).attr("data-index"),10);return{element:t,index:e,data:this.options.data.content[e]}}return null},d.prototype.openSegment=function(t){t=parseInt(t,10),0>t||t>this.options.data.content.length-1||c.openSegment(this,d3.select("#"+this.cssPrefix+"segment"+t).node())},d.prototype.closeSegment=function(){var t=this.currentlyOpenSegment;t&&c.closeSegment(this,t)},d.prototype.updateProp=function(t,e){switch(t){case"header.title.text":var n=s.processObj(this.options,t);s.processObj(this.options,t,e),d3.select("#"+this.cssPrefix+"title").html(e),(""===n&&""!==e||""!==n&&""===e)&&this.redraw();break;case"header.subtitle.text":var o=s.processObj(this.options,t);s.processObj(this.options,t,e),d3.select("#"+this.cssPrefix+"subtitle").html(e),(""===o&&""!==e||""!==o&&""===e)&&this.redraw();break;case"callbacks.onload":case"callbacks.onMouseoverSegment":case"callbacks.onMouseoutSegment":case"callbacks.onClickSegment":case"effects.pullOutSegmentOnClick.effect":case"effects.pullOutSegmentOnClick.speed":case"effects.pullOutSegmentOnClick.size":case"effects.highlightSegmentOnMouseover":case"effects.highlightLuminosity":s.processObj(this.options,t,e);break;default:s.processObj(this.options,t,e),this.destroy(),this.recreate()}};var f=function(){this.svg=s.addSVGSpace(this),this.textComponents={headerHeight:0,title:{exists:""!==this.options.header.title.text,h:0,w:0},subtitle:{exists:""!==this.options.header.subtitle.text,h:0,w:0},footer:{exists:""!==this.options.footer.text,h:0,w:0}},this.outerLabelGroupData=[],this.textComponents.title.exists&&u.addTitle(this),this.textComponents.subtitle.exists&&u.addSubtitle(this),u.addFooter(this);var t=this;s.whenIdExists(this.cssPrefix+"footer",function(){u.positionFooter(t);var e=s.getDimensions(t.cssPrefix+"footer");t.textComponents.footer.h=e.h,t.textComponents.footer.w=e.w});var e=[];this.textComponents.title.exists&&e.push(this.cssPrefix+"title"),this.textComponents.subtitle.exists&&e.push(this.cssPrefix+"subtitle"),this.textComponents.footer.exists&&e.push(this.cssPrefix+"footer"),s.whenElementsExist(e,function(){if(t.textComponents.title.exists){var e=s.getDimensions(t.cssPrefix+"title");t.textComponents.title.h=e.h,t.textComponents.title.w=e.w}if(t.textComponents.subtitle.exists){var n=s.getDimensions(t.cssPrefix+"subtitle");t.textComponents.subtitle.h=n.h,t.textComponents.subtitle.w=n.w}if(t.textComponents.title.exists||t.textComponents.subtitle.exists){var o=0;t.textComponents.title.exists&&(o+=t.textComponents.title.h,t.textComponents.subtitle.exists&&(o+=t.options.header.titleSubtitlePadding)),t.textComponents.subtitle.exists&&(o+=t.textComponents.subtitle.h),t.textComponents.headerHeight=o}r.computePieRadius(t),r.calculatePieCenter(t),u.positionTitle(t),u.positionSubtitle(t),t.options.misc.gradient.enabled&&c.addGradients(t),c.create(t),l.add(t,"inner",t.options.labels.inner.format),l.add(t,"outer",t.options.labels.outer.format),l.positionLabelElements(t,"inner",t.options.labels.inner.format),l.positionLabelElements(t,"outer",t.options.labels.outer.format),l.computeOuterLabelCoords(t),l.positionLabelGroups(t,"outer"),l.computeLabelLinePositions(t),t.options.labels.lines.enabled&&"none"!==t.options.labels.outer.format&&l.addLabelLines(t),l.positionLabelGroups(t,"inner"),l.fadeInLabelsAndLines(t),t.options.tooltips.enabled&&p.addTooltips(t),c.addSegmentEventHandlers(t)
})};return d});